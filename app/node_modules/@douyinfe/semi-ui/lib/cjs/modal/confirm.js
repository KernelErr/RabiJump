"use strict";

var _Object$defineProperty = require("@babel/runtime-corejs3/core-js-stable/object/define-property");

var _interopRequireDefault = require("@babel/runtime-corejs3/helpers/interopRequireDefault");

_Object$defineProperty(exports, "__esModule", {
  value: true
});

exports.default = confirm;
exports.withConfirm = withConfirm;
exports.withError = withError;
exports.withInfo = withInfo;
exports.withSuccess = withSuccess;
exports.withWarning = withWarning;

var _assign = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/assign"));

var _splice = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/splice"));

var _get2 = _interopRequireDefault(require("lodash/get"));

var _react = _interopRequireDefault(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _Modal = require("./Modal");

var _ConfirmModal = _interopRequireDefault(require("./ConfirmModal"));

require("@douyinfe/semi-foundation/lib/cjs/modal/modal.css");

var _semiIcons = require("@douyinfe/semi-icons");

function confirm(props) {
  // create a dom in adapter?
  const div = document.createElement('div');
  document.body.appendChild(div);
  let currentConfig = (0, _assign.default)({}, props);

  const destroy = () => {
    const unmountResult = _reactDom.default.unmountComponentAtNode(div);

    if (unmountResult && div.parentNode) {
      div.parentNode.removeChild(div);
    }

    for (let i = 0; i < _Modal.destroyFns.length; i++) {
      const fn = _Modal.destroyFns[i]; // eslint-disable-next-line @typescript-eslint/no-use-before-define

      if (fn === close) {
        (0, _splice.default)(_Modal.destroyFns).call(_Modal.destroyFns, i, 1);
        break;
      }
    }
  };

  const mergedMotion = typeof props.motion === 'undefined' || props.motion ? (0, _assign.default)((0, _assign.default)({}, props.motion), {
    didLeave: function () {
      const didLeave = (0, _get2.default)(props.motion, 'didLeave');

      if (typeof didLeave === 'function') {
        didLeave(...arguments);
      }

      destroy();
    }
  }) : false;

  function render(renderProps) {
    _reactDom.default.render( /*#__PURE__*/_react.default.createElement(_ConfirmModal.default, (0, _assign.default)({}, renderProps, {
      motion: mergedMotion
    })), div);
  }

  function close() {
    currentConfig = (0, _assign.default)((0, _assign.default)({}, currentConfig), {
      visible: false
    });
    render(currentConfig);
  }

  function update(newConfig) {
    currentConfig = (0, _assign.default)((0, _assign.default)({}, currentConfig), newConfig);
    render(currentConfig);
  }

  render(currentConfig);

  _Modal.destroyFns.push(close);

  return {
    destroy: close,
    update
  };
}

function withInfo(props) {
  return (0, _assign.default)({
    type: 'info',
    icon: /*#__PURE__*/_react.default.createElement(_semiIcons.IconInfoCircle, null)
  }, props);
}

function withSuccess(props) {
  return (0, _assign.default)({
    type: 'success',
    icon: /*#__PURE__*/_react.default.createElement(_semiIcons.IconTickCircle, null)
  }, props);
}

function withWarning(props) {
  return (0, _assign.default)({
    type: 'warning',
    icon: /*#__PURE__*/_react.default.createElement(_semiIcons.IconAlertTriangle, null)
  }, props);
}

function withError(props) {
  return (0, _assign.default)({
    type: 'error',
    icon: /*#__PURE__*/_react.default.createElement(_semiIcons.IconAlertCircle, null)
  }, props);
}

function withConfirm(props) {
  return (0, _assign.default)({
    type: 'confirm',
    icon: /*#__PURE__*/_react.default.createElement(_semiIcons.IconHelpCircle, null)
  }, props);
}