"use strict";

var _Object$defineProperty = require("@babel/runtime-corejs3/core-js-stable/object/define-property");

var _interopRequireDefault = require("@babel/runtime-corejs3/helpers/interopRequireDefault");

_Object$defineProperty(exports, "__esModule", {
  value: true
});

exports.default = void 0;

var _reduce = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/reduce"));

var _values = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/values"));

var _includes = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/includes"));

var _concat = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/concat"));

var _map = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/instance/map"));

var _assign = _interopRequireDefault(require("@babel/runtime-corejs3/core-js-stable/object/assign"));

var _react = require("react");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _classnames = _interopRequireDefault(require("classnames"));

var _semiAnimationStyled = require("@douyinfe/semi-animation-styled");

var _noop = _interopRequireDefault(require("./utils/noop"));

var _invokeFns = _interopRequireDefault(require("./utils/invokeFns"));

var _context;

const types = (0, _reduce.default)(_context = (0, _values.default)(_semiAnimationStyled.types)).call(_context, (arr, cur) => [...arr, ...cur], []);

class StyledAnimation extends _react.PureComponent {
  constructor() {
    var _this;

    let props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    super(props);
    _this = this;

    this._generateAnimateEvents = function (child) {
      let props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      return {
        onAnimationIteration: function () {
          for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
            args[_key] = arguments[_key];
          }

          return (0, _invokeFns.default)([child && child.props && child.props.onAnimationIteration, props.onFrame], args);
        },
        onAnimationStart: function () {
          for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
            args[_key2] = arguments[_key2];
          }

          return (0, _invokeFns.default)([child && child.props && child.props.onAnimationStart, props.onStart], args);
        },
        onAnimationEnd: function () {
          for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
            args[_key3] = arguments[_key3];
          }

          return (0, _invokeFns.default)([child && child.props && child.props.onAnimationEnd, props.onRest], args);
        }
      };
    };

    this._hasSpeedClass = function () {
      let speed = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _this.props.speed;
      return speed != null && (0, _includes.default)(_semiAnimationStyled.speeds).call(_semiAnimationStyled.speeds, speed);
    };

    this._hasTypeClass = function () {
      let type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _this.props.type;
      return type != null && (0, _includes.default)(types).call(types, type);
    };

    this._hasDelayClass = function () {
      let delay = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _this.props.delay;
      return delay != null && (0, _includes.default)(_semiAnimationStyled.delays).call(_semiAnimationStyled.delays, delay);
    };

    this._hasLoopClass = function () {
      let loop = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : _this.props.loop;
      return loop != null && (0, _includes.default)(_semiAnimationStyled.loops).call(_semiAnimationStyled.loops, loop);
    };
  }

  render() {
    var _context2, _context3, _context4, _context5;

    let {
      type,
      speed,
      duration,
      delay,
      loop,
      reverse,
      children,
      prefixCls,
      timing,
      className,
      fillMode
    } = this.props;

    const hasTypeClass = this._hasTypeClass();

    const hasSpeedClass = this._hasSpeedClass();

    const hasDelayClass = this._hasDelayClass();

    const hasLoopClass = this._hasLoopClass();

    const animateCls = className || (0, _classnames.default)("".concat(prefixCls, "-animated"), {
      [(0, _concat.default)(_context2 = "".concat(prefixCls, "-")).call(_context2, type)]: Boolean(type),
      [(0, _concat.default)(_context3 = "".concat(prefixCls, "-speed-")).call(_context3, speed)]: hasSpeedClass,
      [(0, _concat.default)(_context4 = "".concat(prefixCls, "-delay-")).call(_context4, delay)]: hasDelayClass,
      [(0, _concat.default)(_context5 = "".concat(prefixCls, "-loop-")).call(_context5, loop)]: hasLoopClass
    });
    const animateStyle = {
      animationTimingFunction: timing,
      animationName: !hasTypeClass && type,
      animationDuration: duration,
      animationDelay: !hasDelayClass && delay,
      animationIterationCount: !hasLoopClass && loop,
      animationDirection: reverse ? 'alternate' : 'normal',
      animationFillMode: fillMode
    };

    if ( /*#__PURE__*/(0, _react.isValidElement)(children)) {
      children = (0, _map.default)(_react.Children).call(_react.Children, children, child => {
        const animateEvents = this._generateAnimateEvents(child, this.props);

        return /*#__PURE__*/(0, _react.cloneElement)(child, (0, _assign.default)({
          className: (0, _classnames.default)(child.props.className, animateCls),
          style: (0, _assign.default)((0, _assign.default)({}, child.props.style), this.props.style)
        }, animateEvents));
      });
    }

    return typeof children === 'function' ? children({
      animateCls,
      animateStyle,
      animateEvents: this._generateAnimateEvents(null, this.props)
    }) : children;
  }

}

exports.default = StyledAnimation;
StyledAnimation.propTypes = {
  className: _propTypes.default.string,
  type: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.any]),
  speed: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.number]),
  delay: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.number]),
  reverse: _propTypes.default.oneOfType([_propTypes.default.bool, _propTypes.default.string]),
  loop: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.number]),
  children: _propTypes.default.any,
  onStart: _propTypes.default.func,
  onFrame: _propTypes.default.func,
  onRest: _propTypes.default.func,
  prefixCls: _propTypes.default.string,
  timing: _propTypes.default.string,
  duration: _propTypes.default.oneOfType([_propTypes.default.string, _propTypes.default.number]),
  fillMode: _propTypes.default.string
};
StyledAnimation.defaultProps = {
  prefixCls: 'semi',
  speed: 'faster',
  onFrame: _noop.default,
  onStart: _noop.default,
  onRest: _noop.default
};